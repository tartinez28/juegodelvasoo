<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Juego de Memoria</title>
  <style>
    :root{
      --bg: #0f172a;
      --card-back: linear-gradient(135deg,#0ea5e9,#6366f1);
      --card-front: #fff;
      --accent: #06b6d4;
      --card-size: 96px;
    }
    * { box-sizing: border-box; }
    html,body{ height:100%; margin:0; font-family:Inter,system-ui,Arial; background: linear-gradient(180deg,#020617 0%, #081030 60%); color:#e6eef8; }
    .app {
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
    }

    .panel {
      width:100%;
      max-width:920px;
      background: rgba(255,255,255,0.03);
      border-radius:12px;
      padding:18px;
      box-shadow: 0 8px 30px rgba(2,6,23,0.6);
      backdrop-filter: blur(6px);
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:14px;
    }
    h1{ font-size:20px; margin:0; color:#f8fafc; display:flex; align-items:center; gap:10px; }
    .controls { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .btn {
      background:var(--accent);
      color:#042027;
      border:none;
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      box-shadow: 0 6px 12px rgba(3,7,18,0.5);
    }
    .btn.ghost {
      background:transparent;
      color:#cfeff6;
      border:1px solid rgba(255,255,255,0.06);
      box-shadow:none;
    }
    .stats { display:flex; gap:12px; align-items:center; color:#cfeff6; font-weight:600; }
    .board-wrap { display:flex; gap:18px; flex-direction:column; align-items:center; }

    /* Grid */
    .board {
      display:grid;
      grid-template-columns: repeat(4, var(--card-size));
      gap:12px;
      justify-content:center;
      padding:12px;
    }

    /* Responsive: 3 cols on small screens */
    @media (max-width:520px){
      :root{ --card-size:72px; }
      .board { grid-template-columns: repeat(3, var(--card-size)); }
    }

    /* Card */
    .card {
      width:var(--card-size);
      height:var(--card-size);
      perspective:1000px;
    }
    .card-inner {
      width:100%;
      height:100%;
      position:relative;
      transform-style:preserve-3d;
      transition: transform 450ms cubic-bezier(.2,.8,.2,1);
      border-radius:10px;
      cursor:pointer;
    }
    .card.flipped .card-inner {
      transform: rotateY(180deg);
    }
    .face {
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      backface-visibility:hidden;
      border-radius:10px;
      font-size:36px;
      user-select:none;
    }
    .front {
      background:var(--card-front);
      color:#0b1220;
      transform: rotateY(180deg);
      box-shadow: 0 4px 10px rgba(2,6,23,0.2);
      font-size:28px;
    }
    .back {
      background: var(--card-back);
      color:transparent; /* to hide emoji if used as text on back */
      display:flex;
      align-items:center;
      justify-content:center;
      color:#fff;
      font-size:26px;
      box-shadow: inset 0 -6px 18px rgba(0,0,0,0.18);
    }

    /* Matched animation */
    .card.matched .card-inner { animation: pop 420ms ease forwards; }
    @keyframes pop {
      0% { transform: scale(1) rotateY(180deg); }
      50% { transform: scale(1.06) rotateY(180deg); }
      100% { transform: scale(1) rotateY(180deg); }
    }

    footer { margin-top:12px; color:#9fcad8; font-size:13px; display:flex; justify-content:space-between; align-items:center; }
    .small { font-size:13px; color:#cfeff6; opacity:0.85; }
  </style>
</head>
<body>
  <div class="app">
    <div class="panel" role="application" aria-label="Juego de Memoria">
      <header>
        <h1>ðŸ§  Juego de Memoria</h1>
        <div class="controls">
          <div class="stats" aria-hidden="false">
            <div id="moves">Movimientos: 0</div>
            <div id="time">Tiempo: 00:00</div>
            <div id="matches">Parejas: 0 / 8</div>
          </div>
          <button id="restart" class="btn" title="Reiniciar">ðŸ”„ Reiniciar</button>
          <button id="newGame" class="btn ghost" title="Nueva partida">ðŸ”€ Nueva</button>
        </div>
      </header>

      <main class="board-wrap">
        <div id="board" class="board" aria-live="polite"></div>

        <div style="display:flex;gap:14px;align-items:center;margin-top:12px;">
          <label for="size" class="small">Dificultad:</label>
          <select id="size" style="padding:8px;border-radius:6px;background:transparent;color:#e6eef8;border:1px solid rgba(255,255,255,0.06);">
            <option value="4">4x2 (8 cartas)</option>
            <option value="8" selected>4x4 (16 cartas)</option>
            <option value="12">6x4 (24 cartas)</option>
          </select>
          <button id="hint" class="btn ghost" title="Mostrar todas brevemente">ðŸ’¡ Pista</button>
        </div>

        <footer>
          <div class="small">Mejor: <span id="best">â€”</span> movimientos</div>
          <div class="small">Hecho por: Tu juego</div>
        </footer>
      </main>
    </div>
  </div>

  <script>
    // --- ConfiguraciÃ³n inicial ---
    const EMOJIS = ["ðŸŽ","ðŸŒ","ðŸ‡","ðŸ“","ðŸ‘","ðŸ","ðŸ‰","ðŸ¥","ðŸ’","ðŸ¥¥","ðŸ","ðŸ‹"];
    const boardEl = document.getElementById('board');
    const movesEl = document.getElementById('moves');
    const timeEl = document.getElementById('time');
    const matchesEl = document.getElementById('matches');
    const restartBtn = document.getElementById('restart');
    const newGameBtn = document.getElementById('newGame');
    const sizeSelect = document.getElementById('size');
    const hintBtn = document.getElementById('hint');
    const bestEl = document.getElementById('best');

    let totalPairs = 8;      // default pairs for 4x4
    let cards = [];
    let firstIndex = null;
    let secondIndex = null;
    let lockBoard = false;
    let moves = 0;
    let matches = 0;
    let timerInterval = null;
    let seconds = 0;

    // --- Utilities ---
    function shuffle(array){
      // Fisher-Yates
      for(let i = array.length -1; i>0; i--){
        const j = Math.floor(Math.random()*(i+1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function formatTime(s){
      const mm = String(Math.floor(s/60)).padStart(2,'0');
      const ss = String(s%60).padStart(2,'0');
      return `${mm}:${ss}`;
    }

    // --- Game setup ---
    function buildDeck(pairs){
      // choose pairs emojis and duplicate
      const chosen = EMOJIS.slice(0); // copy
      shuffle(chosen);
      const selection = chosen.slice(0, pairs);
      const deck = selection.flatMap((v, i) => ([
        { id: `${i}-a`, value: v, matched:false },
        { id: `${i}-b`, value: v, matched:false }
      ]));
      return shuffle(deck);
    }

    function renderBoard(){
      boardEl.innerHTML = '';
      cards.forEach((card, idx) => {
        const cardWrap = document.createElement('div');
        cardWrap.className = 'card' + (card.flipped ? ' flipped' : '') + (card.matched ? ' matched' : '');
        cardWrap.setAttribute('data-index', idx);
        cardWrap.setAttribute('role','button');
        cardWrap.setAttribute('aria-label', card.matched ? `Pareja encontrada ${card.value}` : `Carta sin voltear`);
        cardWrap.tabIndex = 0;

        const inner = document.createElement('div');
        inner.className = 'card-inner';

        const front = document.createElement('div');
        front.className = 'face front';
        front.textContent = card.value;

        const back = document.createElement('div');
        back.className = 'face back';
        back.textContent = 'â“';

        inner.appendChild(front);
        inner.appendChild(back);
        cardWrap.appendChild(inner);

        // click handler
        cardWrap.addEventListener('click', () => onCardClick(idx));
        cardWrap.addEventListener('keydown', (e) => {
          if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); onCardClick(idx); }
        });

        boardEl.appendChild(cardWrap);
      });
    }

    function startTimer(){
      clearInterval(timerInterval);
      seconds = 0;
      timeEl.textContent = `Tiempo: ${formatTime(seconds)}`;
      timerInterval = setInterval(() => {
        seconds++;
        timeEl.textContent = `Tiempo: ${formatTime(seconds)}`;
      }, 1000);
    }

    function stopTimer(){
      clearInterval(timerInterval);
      timerInterval = null;
    }

    function resetGame(pairsCount){
      stopTimer();
      totalPairs = pairsCount;
      firstIndex = null;
      secondIndex = null;
      lockBoard = false;
      moves = 0;
      matches = 0;
      movesEl.textContent = `Movimientos: ${moves}`;
      matchesEl.textContent = `Parejas: ${matches} / ${totalPairs}`;
      cards = buildDeck(totalPairs);
      cards.forEach(c => { c.flipped = false; c.matched = false; });
      renderBoard();
      startTimer();
      loadBest();
    }

    // --- Interaction ---
    function onCardClick(index){
      if(lockBoard) return;
      const card = cards[index];
      if(!card || card.flipped || card.matched) return;

      // flip
      card.flipped = true;
      renderBoard();

      if(firstIndex === null){
        firstIndex = index;
        return;
      }
      if(secondIndex === null){
        secondIndex = index;
        lockBoard = true;
        moves++;
        movesEl.textContent = `Movimientos: ${moves}`;

        // compare
        const a = cards[firstIndex], b = cards[secondIndex];
        if(a.value === b.value){
          // match
          a.matched = true;
          b.matched = true;
          matches++;
          matchesEl.textContent = `Parejas: ${matches} / ${totalPairs}`;
          // small delay to show matched animation
          setTimeout(() => {
            renderBoard();
            resetSelection();
            if(matches === totalPairs) onWin();
          }, 400);
        } else {
          // not matched -> flip back after delay
          setTimeout(() => {
            a.flipped = false;
            b.flipped = false;
            renderBoard();
            resetSelection();
          }, 1000);
        }
      }
    }

    function resetSelection(){
      firstIndex = null;
      secondIndex = null;
      lockBoard = false;
    }

    function onWin(){
      stopTimer();
      saveBest();
      setTimeout(() => {
        alert(`Â¡Felicidades! Ganaste en ${moves} movimientos y ${formatTime(seconds)}.`);
      }, 150);
    }

    // --- Best score (localStorage) ---
    function bestKey(){
      return `memory_best_${totalPairs}`;
    }
    function loadBest(){
      const b = localStorage.getItem(bestKey());
      bestEl.textContent = b ? b : 'â€”';
    }
    function saveBest(){
      const key = bestKey();
      const prev = parseInt(localStorage.getItem(key) || '0', 10);
      if(!prev || moves < prev){
        localStorage.setItem(key, String(moves));
        bestEl.textContent = String(moves);
      }
    }

    // --- Controls ---
    restartBtn.addEventListener('click', () => {
      // reshuffle same difficulty
      resetGame(totalPairs);
    });
    newGameBtn.addEventListener('click', () => {
      totalPairs = parseInt(sizeSelect.value, 10);
      resetGame(totalPairs);
    });
    sizeSelect.addEventListener('change', () => {
      totalPairs = parseInt(sizeSelect.value, 10);
      resetGame(totalPairs);
    });

    hintBtn.addEventListener('click', () => {
      // show all briefly
      if(lockBoard) return;
      cards.forEach(c => c.flipped = true);
      renderBoard();
      lockBoard = true;
      setTimeout(() => {
        cards.forEach(c => { if(!c.matched) c.flipped = false; });
        renderBoard();
        lockBoard = false;
      }, 900);
    });

    // Start initial game
    (function init(){
      // default pairs = 8 (4x4)
      const defaultPairs = parseInt(sizeSelect.value, 10);
      resetGame(defaultPairs);
    })();
  </script>
</body>
</html>
